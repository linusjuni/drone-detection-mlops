services:
  train-local:
    build:
      context: .
      dockerfile: dockerfiles/train.dockerfile
    shm_size: '2gb'
    env_file: .env
    environment:
      - MODE=local
    volumes:
      - ./data:/app/data
      - ./models:/app/models
    command: ["--epochs", "10", "--batch-size", "32", "--lr", "0.001"]

  train-cloud:
    build:
      context: .
      dockerfile: dockerfiles/train.dockerfile
    shm_size: '2gb'
    env_file: .env
    environment:
      - MODE=cloud
    command: ["--epochs", "10", "--batch-size", "32", "--lr", "0.001"]

  api-local:
    build:
      context: .
      dockerfile: dockerfiles/api.dockerfile
    env_file: .env
    environment:
      - MODE=local
    ports:
      - "8000:8000"
    volumes:
      - ./models:/app/models

  api-cloud:
    build:
      context: .
      dockerfile: dockerfiles/api.dockerfile
    env_file: .env
    environment:
      - MODE=cloud
    ports:
      - "8000:8000"
